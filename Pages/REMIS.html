<!DOCTYPE html>
<html lang='en'>

<head>
    <title>REMIS Tasks</title>
    <meta charset='utf-8'>


    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/highcharts-3d.js"></script>
    <script src="https://code.highcharts.com/modules/stock.js"></script>
    <script src="https://code.highcharts.com/maps/modules/map.js"></script>
    <script src="https://code.highcharts.com/modules/gantt.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/parallel-coordinates.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/modules/annotations-advanced.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/draggable-points.js"></script>
    <script src="https://code.highcharts.com/modules/static-scale.js"></script>
    <script src="https://code.highcharts.com/modules/broken-axis.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
    <script src="https://code.highcharts.com/modules/tilemap.js"></script>
    <script src="https://code.highcharts.com/modules/timeline.js"></script>
    <script src="https://code.highcharts.com/modules/treemap.js"></script>
    <script src="https://code.highcharts.com/modules/treegraph.js"></script>
    <script src="https://code.highcharts.com/modules/item-series.js"></script>
    <script src="https://code.highcharts.com/modules/drilldown.js"></script>
    <script src="https://code.highcharts.com/modules/histogram-bellcurve.js"></script>
    <script src="https://code.highcharts.com/modules/bullet.js"></script>
    <script src="https://code.highcharts.com/modules/funnel.js"></script>
    <script src="https://code.highcharts.com/modules/funnel3d.js"></script>
    <script src="https://code.highcharts.com/modules/pyramid3d.js"></script>
    <script src="https://code.highcharts.com/modules/networkgraph.js"></script>
    <script src="https://code.highcharts.com/modules/pareto.js"></script>
    <script src="https://code.highcharts.com/modules/pattern-fill.js"></script>
    <script src="https://code.highcharts.com/modules/price-indicator.js"></script>
    <script src="https://code.highcharts.com/modules/sankey.js"></script>
    <script src="https://code.highcharts.com/modules/arc-diagram.js"></script>
    <script src="https://code.highcharts.com/modules/dependency-wheel.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
    <script src="https://code.highcharts.com/modules/sonification.js"></script>
    <script src="https://code.highcharts.com/modules/stock-tools.js"></script>
    <script src="https://code.highcharts.com/modules/streamgraph.js"></script>
    <script src="https://code.highcharts.com/modules/sunburst.js"></script>
    <script src="https://code.highcharts.com/modules/variable-pie.js"></script>
    <script src="https://code.highcharts.com/modules/variwide.js"></script>
    <script src="https://code.highcharts.com/modules/vector.js"></script>
    <script src="https://code.highcharts.com/modules/venn.js"></script>
    <script src="https://code.highcharts.com/modules/windbarb.js"></script>
    <script src="https://code.highcharts.com/modules/wordcloud.js"></script>
    <script src="https://code.highcharts.com/modules/xrange.js"></script>
    <script src="https://code.highcharts.com/modules/no-data-to-display.js"></script>
    <script src="https://code.highcharts.com/modules/drag-panes.js"></script>
    <script src="https://code.highcharts.com/modules/debugger.js"></script>
    <script src="https://code.highcharts.com/modules/dumbbell.js"></script>
    <script src="https://code.highcharts.com/modules/lollipop.js"></script>
    <script src="https://code.highcharts.com/modules/cylinder.js"></script>
    <script src="https://code.highcharts.com/modules/organization.js"></script>
    <script src="https://code.highcharts.com/modules/dotplot.js"></script>
    <script src="https://code.highcharts.com/modules/marker-clusters.js"></script>
    <script src="https://code.highcharts.com/modules/hollowcandlestick.js"></script>
    <script src="https://code.highcharts.com/modules/heikinashi.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
    <script src="luxon.min.js"></script>
    <script src="https://js.arcgis.com/4.21/"></script>
    <style>
        html,
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            background-color: #00000000;
            color: rgb(0, 0, 0);
        }

        .jumbotron {
            /* backdrop-filter: blur(5px); */
            background: rgba(0, 0, 0, 0.5);
            border: 0px solid #fff;
            color: #ffffff;

            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 4px 6px 0px rgba(0, 0, 0, 0.1);
        }

        .jumbotron h2 {
            font-weight: 700;
        }

        .jumbotron p {
            color: #ffffff;
        }

        fieldset {
            border: 2px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }

        legend {
            color: white;
            font-weight: bold;
        }

        .submit-btn input {
            background-color: #00904fb1;
            border: 1px solid white;
            /* Adjust border size as per requirement */
            border-radius: 50px;
            /* Adjust radius as per requirement */
            width: 20%;
            font-size: 15px;
            color: white !important;
            margin-top: 5px;
            margin-bottom: 5px;
            /* Adds space between items */
            cursor: pointer;
            transition: all 0.2s ease-out;
        }

        .submit-btn input:hover {
            background-color: #ffffff56;
            transform: scale(1.1);
            /* Image will zoom in slightly when hovered over */
            border: 2px solid #fff;
            /* Add a border on hover */
        }
    </style>
</head>
<!-- TODO Populate fields -->

<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="jumbotron text-center mt-4">
                    <form id="dataForm">
                        <fieldset>
                            <legend>REMIS</legend>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="REMISReceivedByOrg" name="REMISReceivedByOrg"
                                                        class="form-control">
                                                    <label for="REMISReceivedByOrg" class="label-floating">Recieved
                                                        by Org</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="ContractSignDate" name="ContractSignDate"
                                                        class="form-control">
                                                    <label for="ContractSignDate" class="label-floating">Contract Sign Date</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="REMISDisposalAuthorityID"
                                                        name="REMISDisposalAuthorityID" class="form-control">
                                                    <label for="REMISDisposalAuthorityID" class="label-floating">
                                                        Disposal Authority ID</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="ContractSignDate" name="ContractSignDate"
                                                        class="form-control">
                                                    <label for="ContractSignDate" class="label-floating"> OWI</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="date" id="DecOfAvailabilityDate"
                                                        name="DecOfAvailabilityDate" class="form-control">
                                                    <label for="DecOfAvailabilityDate"
                                                        class="label-floating">Declaration of Availability Date</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="date" id="LastTerminationDate"
                                                        name="LastTerminationDate" class="form-control">
                                                    <label for="LastTerminationDate" class="label-floating">Last
                                                        Termination Date</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="date" id="InvitationDate" name="InvitationDate"
                                                        class="form-control">
                                                    <label for="InvitationDate" class="label-floating">Invitation
                                                        Date</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="project_install_code"
                                                        name="project_install_code" class="form-control">
                                                    <label for="project_install_code"
                                                        class="label-floating">Project/Install Code</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="submit-btn">
                                <input type="submit" id="submitButton" value="Submit Edits">
                            </div>
                        </fieldset>

                    </form>
                    <div id="container"></div>
                    <br>
                    <div class="row">
                        <br>
                        <div id="sync-message" style="margin-bottom: 10px;">Loading...</div>

                        <div id="bidtable"><br>
                            <br>
                        </div>

                    </div>
                    <form id="dataForm2">
                        <br>
                        <fieldset>
                            <legend>Add New Payment</legend>
                            <div class="container-fluid">
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <!-- Payment No -->
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="paymentNo"
                                                    name="P_PAYMENT_NO">
                                                <label for="paymentNo">Payment No</label>
                                            </div>
                                        </div>
                                        <!-- Authority -->
                                        <div class="col-md-3">
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="authority"
                                                    name="P_DISP_AUTH_ID">
                                                <label for="authority">Authority</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <!-- Description -->
                                            <div class="form-floating mb-6">
                                                <input type="text" class="form-control" id="description"
                                                    name="P_DESCRIPTION">
                                                <label for="description">Description</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-md-3">
                                            <!-- Disposition Method -->
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="dispositionMethod"
                                                    name="P_DISPOSAL_TYPE">
                                                <label for="dispositionMethod">Disposition Method</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <!-- Disposition Date -->
                                            <div class="form-floating mb-3">
                                                <input type="date" class="form-control" id="dispositionDate"
                                                    name="P_EXECUTION_DATE">
                                                <label for="dispositionDate">Disposition Date</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <!-- Sale Price -->
                                            <div class="form-floating mb-3">
                                                <input type="number" class="form-control" id="salePrice"
                                                    name="P_CONTRACT_AMOUNT">
                                                <label for="salePrice">Sale Price</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <!-- Gov Cost Avoidance -->
                                            <div class="form-floating mb-3">
                                                <input type="number" class="form-control" id="govCostAvoidance"
                                                    name="P_COSTS_AVOIDANCE">
                                                <label for="govCostAvoidance">Gov Cost Avoidance</label>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <!-- Recorded Date -->
                                            <div class="form-floating mb-3">
                                                <input type="datetime-local" class="form-control" id="recordedDate"
                                                    name="P_RECORDED_DATE">
                                                <label for="recordedDate">Recorded Date</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <!-- Delivery Date -->
                                            <div class="form-floating mb-3">
                                                <input type="date" class="form-control" id="deliveryDate"
                                                    name="P_DELIVERY_DATE">
                                                <label for="deliveryDate">Delivery Date</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <!-- Disposing Org -->
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="disposingOrg"
                                                    name="P_DISPOSING_ORGN">
                                                <label for="disposingOrg">Disposing Org</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <!-- Instrument Type -->
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="instrumentType"
                                                    name="P_INSTRUMENT_TYPE">
                                                <label for="instrumentType">Instrument Type</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <!-- Send Payment to Org -->
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="sendPaymentToOrg"
                                                    name="P_ORG_CODE">
                                                <label for="sendPaymentToOrg">Send Payment to Org</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <!-- Instruction Record Location -->
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="instructionRecordLocation"
                                                    name="P_INSTRUMENT_RECORD_LOCATION">
                                                <label for="instructionRecordLocation">Instruction Record
                                                    Location</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <div class="submit-btn">
                            <input type="submit" value="Submit">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    let changes
    function formatUnixTimestamp(timestamp) {
        // Create a new Date object
        const date = new Date(timestamp);

        // Extract the date components
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0'); // months are 0-indexed
        const day = date.getDate().toString().padStart(2, '0');

        // Format the date string
        return `${year}-${month}-${day}`;
    }
    var urlParams = new URLSearchParams(window.location.search);
    var pgid = urlParams.get('gid');

    function formatTimestamp(timestamp) {
        const options = { day: '2-digit', month: 'short', year: '2-digit' };
        const date = new Date(timestamp);
        return date.toLocaleDateString('en-US', options).toUpperCase();
    }

    let cid
    let org
    let wi
    let code

    require([
        "esri/identity/IdentityManager",
        "esri/request",
        "dojo/domReady!"
    ], function (IdentityManager, esriRequest) {
        esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/0/query", {
            responseType: "json",
            query: {
                where: "GlobalID = '" + pgid + "'",
                outFields: "*",
                f: "json"
            }
        }).then(function (response) {
            renderTasks(response.data.features[0].attributes);
            // Handle the data fetch response
            const attributes = response.data.features[0].attributes;
            changes = {
                "OBJECTID": attributes["OBJECTID"],
            }; // Initialize an empty object to keep track of changes
            cid = attributes["ContractID"]
            org = attributes["REMISDisposalAuthorityID"]
            wi = attributes["REMISReceivedByOrg"]
            code = attributes["project_install_code"]
            for (const attribute in attributes) {
                const formField = document.getElementById(attribute);
                if (formField) {
                    if (formField.type === 'date') {
                        formField.value = formatUnixTimestamp(attributes[attribute]);
                    } else {
                        formField.value = attributes[attribute];
                    }
                }
            }
        });
    });


    function renderTasks(attributes) {

        Highcharts.chart('container', {
            series: [{
                type: 'organization',
                name: 'REMIS',
                keys: ['from', 'to'],
                data: [
                    ['RD22_Parent', 'RD_112'],
                    ['RD22_Parent', 'RD_121'],
                    ['RD22_Appraisal', 'RD_4'],
                    ['RD22_Disposal', 'RD_6'],
                    ['RD_112', 'RD_115'],
                    ['RD_4','Close_Appraisal'],
                    ['RD_6', 'RD_71'],
                    ['RD_71','Close_Disposal'],
                    ['Close_Appraisal','Close_Disposal'],
                    ['Close_Disposal','Close_Parent'],
                    ['RD_115','Close_Parent']
                    
                ],
                linkColor: 'white',
                linkLineWidth: 2,
                nodeWidth: 150,
                nodes: [{
                    id: 'RD22_Parent',
                    title: attributes['rd22ParentDate'] == null
                        ? 'Create RD22 Parent'
                        : (attributes['REMISParentTaskNo'] == null
                            ? `Created RD22 Parent<br>${formatTimestamp(attributes['rd22ParentDate'])}<br>Awaiting Sync`
                            : 'RD22 Parent Created<br>' + formatTimestamp(attributes[rd22ParentDate])),

                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('RD22 Parent clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: attributes['rd22ParentDate'] == null ? '#00000000' : '#00904fb1',
                    borderColor: 'white'
                }, {
                    id: 'RD22_Appraisal',
                    title: '<b>Create Apraisal RD 22</b>',
                    description: 'Create RD22 Appraisal',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 2 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD22_Disposal',
                    title: 'Create Disposal RD22',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 3 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_6',
                    title: 'Create RD6',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 4 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_71',
                    title: 'Create RD71',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 5 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'Close_Appraisal',
                    title: 'Close RD22 Appraisal',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 5 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_4',
                    title: 'Create RD4',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 5 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_112',
                    title: 'Create RD 112',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 6 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_121',
                    title: 'Create RD121',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 6 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'Close_Disposal',
                    title: 'Close RD22 Disposal',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 7 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_115',
                    title: 'Create RD 115',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 7 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'Close_Parent',
                    title: 'Close RD22 Parent',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 7 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }]
            }],
            chart: {
                backgroundColor: 'rgba(0, 0, 0, 0)' // Set the background color to clear
            },
            exporting: {
                enabled: false
            },
            credits: {
                enabled: false
            },
            title: {
                text: ''
            }
        });
    }

    Array.from(document.querySelectorAll('input, select')).forEach((element) => {
        element.addEventListener('input', function (event) {
            // Update the changes object when a field changes
            changes[event.target.id] = event.target.value;
        });
    });

    document.getElementById('dataForm').addEventListener('submit', function (event) {
        // Prevent the default form submit action
        require([
            "esri/identity/IdentityManager",
            "esri/request",
            "dojo/domReady!"
        ], function (IdentityManager, esriRequest) {
            // Add an input event listener to all input fields

            // Listen for form submit event

            event.preventDefault();

            // Create features array
            const features = [{
                "attributes": changes // Use the changes object here
            }];

            // Convert features to URL-encoded string
            const formData = new URLSearchParams();
            formData.append('f', 'json');
            formData.append('updates', JSON.stringify(features));

            // Send a POST request to your REST endpoint
            esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/0/applyEdits", {
                method: "post",
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: formData.toString()
            }).then(function (response) {
                const success = response.data.updateResults[0];
                const submitButton = document.getElementById('submitButton');  // Selecting the button

                if (success) {
                    submitButton.value = 'SUCCESS!';
                } else {
                    submitButton.value = 'FAILED!';
                }

                setTimeout(() => {
                    submitButton.value = 'Submit Edits'; // clear the message after 3 seconds
                }, 3000);
            });

        })
    });
    require(["esri/identity/IdentityManager", "esri/request", "dojo/domReady!"], function (IdentityManager, esriRequest) {
        // Fetch the data when the document is ready
        esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/15/query", {
            responseType: "json",
            query: {
                where: "parentglobalid = '" + pgid + "'",
                outFields: "*",
                f: "json"
            }
        }).then(function (response) {

            // Extract data
        var tableData = response.data.features.map(function (feature) {
            return feature.attributes;
        });

        // Initialize REMIS Sync counter
        var remisSyncedCount = tableData.reduce(function (count, row) {
            return count + (row.REMIS_Sync ? 1 : 0);
        }, 0);

        // Update the message
        var messageDiv = document.getElementById('sync-message');
        if (messageDiv) {
            messageDiv.innerText = `${remisSyncedCount} of ${tableData.length} Payments Sync'd with REMIS`;
        }

            // Define table
            var table = new Tabulator("#bidtable", {
                data: tableData, //assign data to table
                columns: [
                    { title: "Contract No", field: "P_CONTRACT_NO", headerFilter: "input", visible: false },
                    { title: "Payment No", field: "P_PAYMENT_NO" },
                    { title: "Description", field: "P_DESCRIPTION" },
                    { title: "Authority", field: "P_DISP_AUTH_ID" },
                    { title: "Disposition Method", field: "P_DISPOSAL_TYPE" },
                    { title: "Disposition Date", field: "P_EXECUTION_DATE" },
                    { title: "Sale Price", field: "P_CONTRACT_AMOUNT" },
                    { title: "GlobalID", field: "GlobalID", visible: false },
                    { title: "Gov Cost Avoidance", field: "P_COSTS_AVOIDANCE" },
                    { title: "Recorded Date", field: "P_RECORDED_DATE", formatter: "datetime" },
                    { title: "Delivery Date", field: "P_DELIVERY_DATE" },
                    { title: "Disposing Org", field: "P_DISPOSING_ORGN" },
                    { title: "Parent GlobalID", field: "parentglobalid", visible: false },
                    { title: "Sync'd With REMIS?", field: "REMIS_Sync", formatter: "tickCross", formatterParams: { allowEmpty: false } },
                    { title: "Instrument Type", field: "P_INSTRUMENT_TYPE" },
                    { title: "ObjectID", field: "ObjectID", visible: false },
                    { title: "Send Payment to Org", field: "P_ORG_CODE" },
                    { title: "Instruction Record Location", field: "P_INSTRUMENT_RECORD_LOCATION" }

                ]
            });

        })
    });

    require(["esri/identity/IdentityManager", "esri/request", "dojo/domReady!"],
        function (IdentityManager, esriRequest) {

            document.getElementById('dataForm2').addEventListener('submit', function (event) {
                // Prevent the default form submit action
                event.preventDefault();
                const P_PAYMENT_NO = document.getElementById('P_PAYMENT_NO').value;
                const P_DESCRIPTION = document.getElementById('P_DESCRIPTION').value;
                const P_DISP_AUTH_ID = parseInt(document.getElementById('P_DISP_AUTH_ID').value);
                const P_DISPOSAL_TYPE = parseInt(document.getElementById('P_DISPOSAL_TYPE').value);
                const P_EXECUTION_DATE = parseInt(document.getElementById('P_EXECUTION_DATE').value);
                const P_CONTRACT_AMOUNT = parseInt(document.getElementById('P_CONTRACT_AMOUNT').value);
                const P_COSTS_AVOIDANCE = parseInt(document.getElementById('P_COSTS_AVOIDANCE').value);
                const P_RECORDED_DATE = parseInt(document.getElementById('P_RECORDED_DATE').value);
                const P_DELIVERY_DATE = parseInt(document.getElementById('P_DELIVERY_DATE').value);
                const P_DISPOSING_ORGN = parseInt(document.getElementById('P_DISPOSING_ORGN').value);
                const P_INSTRUMENT_TYPE = parseInt(document.getElementById('P_INSTRUMENT_TYPE').value);
                const P_ORG_CODE = parseInt(document.getElementById('P_ORG_CODE').value);
                const P_INSTRUMENT_RECORD_LOCATION = parseInt(document.getElementById('P_INSTRUMENT_RECORD_LOCATION').value);


                // Create features array
                const features = [{
                    "attributes": {
                        "P_CONTRACT_NO": cid,
                        "P_PAYMENT_NO": P_PAYMENT_NO,
                        "P_DESCRIPTION": P_DESCRIPTION,
                        "P_DISP_AUTH_ID": P_DISP_AUTH_ID,
                        "P_DISPOSAL_TYPE": P_DISPOSAL_TYPE,
                        "P_EXECUTION_DATE": P_EXECUTION_DATE,
                        "P_CONTRACT_AMOUNT": P_CONTRACT_AMOUNT,
                        "P_COSTS_AVOIDANCE": P_COSTS_AVOIDANCE,
                        "P_RECORDED_DATE": P_RECORDED_DATE,
                        "P_DELIVERY_DATE": P_DELIVERY_DATE,
                        "P_DISPOSING_ORGN": P_DISPOSING_ORGN,
                        "P_INSTRUMENT_TYPE": P_INSTRUMENT_TYPE,
                        "P_ORG_CODE": P_ORG_CODE,
                        "P_INSTRUMENT_RECORD_LOCATION": P_INSTRUMENT_RECORD_LOCATION,
                        "parentglobalid": pgid
                    }
                }];

                // Convert features to URL-encoded string
                console.log(features)

                const formData = new URLSearchParams();
                formData.append('f', 'json');
                formData.append('features', JSON.stringify(features));
                // Send a POST request to your REST endpoint
                esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/8/addFeatures", {
                    method: "post",
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData.toString()
                }).then(function (response) {
                    const success = response.data.updateResults[0];
                    const submitButton = document.getElementById('submitButton');  // Selecting the button

                    if (success) {
                        submitButton.value = 'SUCCESS!';
                    } else {
                        submitButton.value = 'FAILED!';
                    }

                    setTimeout(() => {
                        submitButton.value = 'Submit Edits'; // clear the message after 3 seconds
                    }, 3000);
                });
            });
        });

</script>

</html>
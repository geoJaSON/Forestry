<!DOCTYPE html>
<html lang='en'>

<head>
    <title>REMIS Tasks</title>
    <meta charset='utf-8'>


    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/highcharts-3d.js"></script>
    <script src="https://code.highcharts.com/modules/stock.js"></script>
    <script src="https://code.highcharts.com/maps/modules/map.js"></script>
    <script src="https://code.highcharts.com/modules/gantt.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/parallel-coordinates.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/modules/annotations-advanced.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/draggable-points.js"></script>
    <script src="https://code.highcharts.com/modules/static-scale.js"></script>
    <script src="https://code.highcharts.com/modules/broken-axis.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
    <script src="https://code.highcharts.com/modules/tilemap.js"></script>
    <script src="https://code.highcharts.com/modules/timeline.js"></script>
    <script src="https://code.highcharts.com/modules/treemap.js"></script>
    <script src="https://code.highcharts.com/modules/treegraph.js"></script>
    <script src="https://code.highcharts.com/modules/item-series.js"></script>
    <script src="https://code.highcharts.com/modules/drilldown.js"></script>
    <script src="https://code.highcharts.com/modules/histogram-bellcurve.js"></script>
    <script src="https://code.highcharts.com/modules/bullet.js"></script>
    <script src="https://code.highcharts.com/modules/funnel.js"></script>
    <script src="https://code.highcharts.com/modules/funnel3d.js"></script>
    <script src="https://code.highcharts.com/modules/pyramid3d.js"></script>
    <script src="https://code.highcharts.com/modules/networkgraph.js"></script>
    <script src="https://code.highcharts.com/modules/pareto.js"></script>
    <script src="https://code.highcharts.com/modules/pattern-fill.js"></script>
    <script src="https://code.highcharts.com/modules/price-indicator.js"></script>
    <script src="https://code.highcharts.com/modules/sankey.js"></script>
    <script src="https://code.highcharts.com/modules/arc-diagram.js"></script>
    <script src="https://code.highcharts.com/modules/dependency-wheel.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
    <script src="https://code.highcharts.com/modules/sonification.js"></script>
    <script src="https://code.highcharts.com/modules/stock-tools.js"></script>
    <script src="https://code.highcharts.com/modules/streamgraph.js"></script>
    <script src="https://code.highcharts.com/modules/sunburst.js"></script>
    <script src="https://code.highcharts.com/modules/variable-pie.js"></script>
    <script src="https://code.highcharts.com/modules/variwide.js"></script>
    <script src="https://code.highcharts.com/modules/vector.js"></script>
    <script src="https://code.highcharts.com/modules/venn.js"></script>
    <script src="https://code.highcharts.com/modules/windbarb.js"></script>
    <script src="https://code.highcharts.com/modules/wordcloud.js"></script>
    <script src="https://code.highcharts.com/modules/xrange.js"></script>
    <script src="https://code.highcharts.com/modules/no-data-to-display.js"></script>
    <script src="https://code.highcharts.com/modules/drag-panes.js"></script>
    <script src="https://code.highcharts.com/modules/debugger.js"></script>
    <script src="https://code.highcharts.com/modules/dumbbell.js"></script>
    <script src="https://code.highcharts.com/modules/lollipop.js"></script>
    <script src="https://code.highcharts.com/modules/cylinder.js"></script>
    <script src="https://code.highcharts.com/modules/organization.js"></script>
    <script src="https://code.highcharts.com/modules/dotplot.js"></script>
    <script src="https://code.highcharts.com/modules/marker-clusters.js"></script>
    <script src="https://code.highcharts.com/modules/hollowcandlestick.js"></script>
    <script src="https://code.highcharts.com/modules/heikinashi.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script src="https://js.arcgis.com/4.21/"></script>
    <style>
        html,
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            background-color: #00000000;
            color: rgb(0, 0, 0);
        }

        .jumbotron {
            /* backdrop-filter: blur(5px); */
            background: rgba(0, 0, 0, 0.5);
            border: 0px solid #fff;
            color: #ffffff;

            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 4px 6px 0px rgba(0, 0, 0, 0.1);
        }

        .jumbotron h2 {
            font-weight: 700;
        }

        .jumbotron p {
            color: #ffffff;
        }
    </style>
</head>
<!-- TODO Populate fields -->
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="jumbotron text-center mt-4">
                    <form id="dataForm">
                        <fieldset>
                            <legend>REMIS</legend>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="ContractSignDate" name="ContractSignDate"
                                                        class="form-control">
                                                    <label for="ContractSignDate" class="label-floating">REMIS Recieved
                                                        by Org</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="ContractSignDate" name="ContractSignDate"
                                                        class="form-control">
                                                    <label for="ContractSignDate" class="label-floating">REMIS Project
                                                        Install Code</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="REMISDisposalAuthorityID"
                                                        name="REMISDisposalAuthorityID" class="form-control">
                                                    <label for="REMISDisposalAuthorityID" class="label-floating">REMIS
                                                        Disposal Authority ID</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating mb-3">
                                                    <input type="text" id="ContractSignDate" name="ContractSignDate"
                                                        class="form-control">
                                                    <label for="ContractSignDate" class="label-floating">REMIS
                                                        OWI</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                    <div id="container"></div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var urlParams = new URLSearchParams(window.location.search);
    var pgid = urlParams.get('gid');

    function formatTimestamp(timestamp) {
        const options = { day: '2-digit', month: 'short', year: '2-digit' };
        const date = new Date(timestamp);
        return date.toLocaleDateString('en-US', options).toUpperCase();
    }

    require([
        "esri/identity/IdentityManager",
        "esri/request",
        "dojo/domReady!"
    ], function (IdentityManager, esriRequest) {
        esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/0/query", {
            responseType: "json",
            query: {
                where: "GlobalID = '" + pgid + "'",
                outFields: "*",
                f: "json"
            }
        }).then(function (response) {
            renderTasks(response.data.features[0].attributes);
        });
    });

    function renderTasks(attributes) {

        Highcharts.chart('container', {
            series: [{
                type: 'organization',
                name: 'REMIS',
                keys: ['from', 'to'],
                data: [
                    ['RD22_Parent', 'RD_112'],
                    ['RD22_Parent', 'RD_121'],
                    ['RD22_Appraisal', 'RD_4'],
                    ['RD22_Disposal', 'Task 4'],
                    ['RD_112', 'RD_115'],
                    ['Task 4', 'Task 7']
                ],
                linkColor: 'white',
                linkLineWidth: 2,
                nodeWidth: 150,
                nodes: [{
                    id: 'RD22_Parent',
                    title: attributes['rd22ParentDate'] == null
                        ? 'Create RD22 Parent'
                        : (attributes['REMISParentTaskNo'] == null
                            ? `Created RD22 Parent<br>${formatTimestamp(attributes['rd22ParentDate'])}<br>Awaiting Sync`
                            : 'RD22 Parent Created<br>' + formatTimestamp(attributes[rd22ParentDate])),

                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('RD22 Parent clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: attributes['rd22ParentDate'] == null ? '#00000000' : '#00904fb1',
                    borderColor: 'white'
                }, {
                    id: 'RD22_Appraisal',
                    title: '<b>Create Apraisal RD 22</b>',
                    description: 'Create RD22 Appraisal',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 2 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD22_Disposal',
                    title: 'Create Disposal RD22',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 3 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'Task 4',
                    title: 'Task 4',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 4 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'Task 5',
                    title: 'Task 5',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 5 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'Task 3',
                    title: 'Task 3',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 5 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_4',
                    title: 'Task 5',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 5 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_112',
                    title: 'Create RD 112',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 6 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_121',
                    title: 'Create RD121',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 6 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'Task 7',
                    title: 'Task 7',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 7 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }, {
                    id: 'RD_115',
                    title: 'Create RD 115',
                    description: 'Click to trigger function',
                    events: {
                        click: function () {
                            // Function to be triggered on click
                            console.log('Task 7 clicked');
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.title}',
                        style: {
                            textOverflow: 'ellipsis',
                            whiteSpace: 'normal',
                            color: 'white'
                        }
                    },
                    color: '#00000000',
                    borderColor: 'white'
                }]
            }],
            chart: {
                backgroundColor: 'rgba(0, 0, 0, 0)' // Set the background color to clear
            },
            exporting: {
                enabled: false
            },
            credits: {
                enabled: false
            },
            title: {
                text: ''
            }
        });
    }
</script>

</html>
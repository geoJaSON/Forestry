<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8' />
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>

    <script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.9/index.global.min.js'></script>
    <script src="https://js.arcgis.com/4.21/"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
            font-size: 14px;
            background-color: #00000000;

        }

        #calendar {
            max-width: 1100px;
            margin: 40px auto;
            padding: 0 10px;
        }
    </style>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                selectable: true,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                dateClick: function (info) {
                    alert('clicked ' + info.dateStr);
                },
                select: function (info) {
                    alert('selected ' + info.startStr + ' to ' + info.endStr);
                }
            });

            calendar.render();
        });

        require([
            "esri/identity/IdentityManager",
            "esri/request",
            "esri/portal/Portal",
            "esri/portal/PortalQueryParams",
            "dojo/domReady!"
        ], function (IdentityManager, esriRequest, Portal, PortalQueryParams) {

            var featuresPromise = esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/0/query", {
                responseType: "json",
                query: {
                    where: "1=1",
                    outFields: "ContractTitle, ContractID, SaleOpeningDate, GlobalID, LoggingStartDate,LoggingEndDate,InvitationDate,IntentToAwardDate,FileDestroyDate,ClosingCoverLetterDate,CertificationToTheFilesDate",
                    f: "json"
                }
            });

            // When data is fetched, transform it and then initialize the calendar
            featuresPromise.then(function (response) {
                var events = transformData(response.data.features);
                initializeCalendar(events);
            });

            // Example transformation function
            // Adjust field mappings as per actual data
            function transformData(features) {
                return features.map(function (feature) {
                    return {
                        title: feature.attributes.ContractTitle,
                        start: feature.attributes.SaleOpeningDate,
                        // ... other properties
                    };
                });
            }

            function initializeCalendar(events) {
                document.addEventListener('DOMContentLoaded', function () {
                    var calendarEl = document.getElementById('calendar');
                    var calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        events: events,
                        selectable: false,
                        headerToolbar: {
                            left: 'prev,next today',
                            center: 'title',
                            right: 'dayGridMonth,timeGridWeek,timeGridDay'
                        }
                        // dateClick: function (info) {
                        //     alert('clicked ' + info.dateStr);
                        // },
                        // select: function (info) {
                        //     alert('selected ' + info.startStr + ' to ' + info.endStr);
                        // }
                    });
                    calendar.render();
                });
            }

        });

    </script>
</head>

<body>
    <div id='calendar'></div>
</body>

</html>
<!DOCTYPE html>
<html>

<head>
    <title>Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="luxon.min.js"></script>
    <link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://js.arcgis.com/4.21/"></script>
</head>
<style>
    input[type="text"],
    input[type="number"],
    select,
    textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }

    .submit-btn {
        display: flex;
        justify-content: center;
    }

    html,
    body {
        font-family: Arial, sans-serif;
        font-size: 12px;
        background-color: #00000000;
        color: rgb(0, 0, 0);
    }

    .jumbotron {
        /* backdrop-filter: blur(5px); */
        background: rgba(0, 0, 0, 0.5);
        border: 0px solid #fff;
        color: #ffffff;

        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 4px 6px 0px rgba(0, 0, 0, 0.1);
    }

    .jumbotron h2 {
        font-weight: 700;
    }

    .jumbotron p {
        color: #ffffff;
    }

    fieldset {
        border: 2px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
    }

    legend {
        color: white;
        font-weight: bold;
    }

    .pdf-btn {
        background-color: #00904fb1;
        border: 1px solid white;
        /* Adjust border size as per requirement */
        border-radius: 50px;
        /* Adjust radius as per requirement */
        /* width: 20%; */
        font-size: 11px;
        color: white !important;
        margin-top: 5px;
        margin-bottom: 5px;
        /* Adds space between items */
        cursor: pointer;
        transition: all 0.2s ease-out;
    }

    .submit-btn input {
        background-color: #00904fb1;
        border: 1px solid white;
        /* Adjust border size as per requirement */
        border-radius: 50px;
        /* Adjust radius as per requirement */
        width: 30%;
        font-size: 15px;
        color: white !important;
        margin-top: 5px;
        margin-bottom: 5px;
        /* Adds space between items */
        cursor: pointer;
        transition: all 0.2s ease-out;
    }

    .pdf-btn:hover {
        background-color: #ffffff56;
        transform: scale(1.1);
        /* Image will zoom in slightly when hovered over */
        border: 2px solid #fff;
    }

    .submit-btn input:hover {
        background-color: #ffffff56;
        transform: scale(1.1);
        /* Image will zoom in slightly when hovered over */
        border: 2px solid #fff;
        /* Add a border on hover */
    }


    .button-container {
        display: flex;
        justify-content: center;
    }
</style>

<body>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10">

                <div class="jumbotron text-center mt-4">
                    <div class="container-fluid">
                        <div class="button-container">
                            <button type="button" id="ltbook" class="btn btn-secondary btn-sm pdf-btn">Load Ticket (by
                                Load
                                Book)</button>
                            <button type="button" id="ltcert" class="btn btn-secondary btn-sm pdf-btn">Load Tickets (by
                                Cert
                                No)</button>
                            <button type="button" id="ltdest" class="btn btn-secondary btn-sm pdf-btn">Load Tickets (by
                                Destination)</button>
                        </div>
                        <div class="button-container">
                            <button type="button" id="scfrs" class="btn btn-secondary btn-sm pdf-btn">Stumpage Coverage
                                (FRS)</button>
                            <button type="button" id="scpurch" class="btn btn-secondary btn-sm pdf-btn">Stumpage
                                Coverage
                                (Purchaser's)</button>
                        </div>
                        <div class="button-container">
                            <button type="button" id="ps" class="btn btn-secondary btn-sm pdf-btn">Purchaser's
                                Statement</button>
                            <button type="button" id="psdate" class="btn btn-secondary btn-sm pdf-btn">Purchaser's
                                Statement (by
                                Date)</button>
                            <button type="button" id="psrock" class="btn btn-secondary btn-sm pdf-btn">Purchaser's
                                Statement
                                (Rock-Slash)</button>
                            <button type="button" id="psaudit" class="btn btn-secondary btn-sm pdf-btn">Purchaser's
                                Statement
                                (Audit)</button>
                        </div>

                    </div>
                    <br>
                    <div class="row">
                        <br>
                        <button id="download-csv">Download CSV</button>
                        <div id="certtable"></div>
                        <br>
                    </div>
                    <br>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Upload PDF
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                            <li><a class="dropdown-item" href="#" data-company="pacific-rim">Pacific Rim Log Scaling</a>
                            </li>
                            <li><a class="dropdown-item" href="#" data-company="northwest">Northwest Log Scalers</a>
                            </li>
                            <li><a class="dropdown-item" href="#" data-company="columbia">Columbia River Log Scalers</a>
                            </li>


                        </ul>

                    </div>
                    <input type="file" id="pdf-input" accept="application/pdf" style="display: none;">
                    <br>
                    <form id="dataForm">
                        <fieldset>
                            <legend>Add New Certificate</legend>
                            <!-- Row 1 -->
                            <div class="row mt-2">
                                <div class="col-md-3">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="loadBookNo" name="loadBookNo">
                                        <label for="loadBookNo" class="label-floating">Book Number</label>

                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="loadTicketNo" name="loadTicketNo">
                                        <label for="loadTicketNo" class="label-floating">Ticket Number</label>

                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="certificateNo" name="certificateNo">
                                        <label for="certificateNo" class="label-floating">Certification Number</label>

                                    </div>
                                </div>


                                <div class="col-md-3">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="date" id="date" name="date">
                                        <label for="date" class="label-floating">Date</label>

                                    </div>
                                </div>
                            </div>

                            <!-- Row 2 -->
                            <div class="row mt-2">
                                <div class="col-md-4">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="destination" name="destination">
                                        <label for="destination" class="label-floating">Destination</label>

                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating mb-3">
                                        <select class="form-select" id="certificateProductProcessed"
                                            name="certificateProductProcessed">
                                            <option value="" disabled selected>Product</option>
                                            <option value="None">None</option>
                                            <option value="Firewood">Firewood</option>
                                            <option value="FishLogs">FishLogs</option>
                                            <option value="HogFuel">HogFuel</option>
                                            <option value="Lumber">Lumber</option>
                                            <option value="Paper">Paper</option>
                                            <option value="Poles">Poles</option>
                                            <option value="Pulp">Pulp</option>
                                            <option value="ShakeFencing">ShakeFencing</option>
                                            <option value="Slash">Slash</option>
                                            <option value="Rock">Rock</option>
                                            <option value="Scraps">Scraps</option>
                                            <option value="Utility">Utility</option>
                                            <option value="Veneer">Veneer</option>
                                        </select> <label for="certificateProductProcessed"
                                            class="label-floating">Product</label>

                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating mb-3">
                                        <select class="form-select" id="species" name="species">
                                            <option value="" disabled selected>Species</option>
                                            <option value="Alder">Alder</option>
                                            <option value="Chamarecyparis">Chamarecyparis</option>
                                            <option value="Cottonwood">Cottonwood</option>
                                            <option value="Douglas Fir">Douglas Fir</option>
                                            <option value="Grand Fir">Grand Fir</option>
                                            <option value="Pacific Madrona">Pacific Madrona</option>
                                            <option value="Pondarosa Pine">Pondarosa Pine</option>
                                            <option value="Red Cedar">Red Cedar</option>
                                            <option value="White Fir">White Fir</option>
                                            <option value="White Oak">White Oak</option>
                                            <option value="Woody Biomass">Woody Biomass</option>
                                        </select> <label for="species" class="label-floating">Species</label>

                                    </div>
                                </div>
                            </div>

                            <!-- Row 3 -->
                            <div class="row mt-2">
                                <div class="col-md-1">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="loads" name="loads"> <label
                                            for="loads" class="label-floating">Loads</label>

                                    </div>
                                </div>
                                <div class="col-md-1">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="acresCut" name="acresCut">
                                        <label for="acresCut" class="label-floating">Acres Cut</label>

                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="sawlog" name="sawlog"> <label
                                            for="sawlog" class="label-floating">Sawlog</label>

                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="utility" name="utility"> <label
                                            for="utility" class="label-floating">Utility</label>

                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="cleanLogUtility"
                                            name="cleanLogUtility">
                                        <label for="cleanLogUtility" class="label-floating">Clean Log Utility</label>

                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="payment" name="payment">
                                        <label for="payment" class="label-floating">Payment</label>

                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" type="text" id="otherChargesDue"
                                            name="otherChargesDue"> <label for="otherChargesDue"
                                            class="label-floating">Other Charges Due</label>

                                    </div>
                                </div>
                            </div>

                            <!-- Row 4 -->
                            <div class="row mt-2">
                                <div class="col-md-12">
                                    <div class="form-floating mb-3">
                                        <textarea class="form-control" id="comments" name="comments"
                                            rows="2"></textarea> <label for="comments"
                                            class="label-floating">Comments</label>

                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <div class="submit-btn">
                            <input type="submit" value="Submit">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="dataModal" tabindex="-1" aria-labelledby="dataModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dataModalLabel">Parsed Ticket Records</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="data-table"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="pdfSubmitBtn" class="btn btn-primary">Submit</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>

</body>

<script>
    let table
    var table2 = new Tabulator("#data-table", {
        columns: [
            { title: "Certificate No", field: "certificate_no", editor: "input" },
            {
                title: "Species", field: "species", editor: "select",
                editorParams: {
                    values: ["Alder",
                        "Chamarecyparis",
                        "Cottonwood",
                        "Douglas Fir",
                        "Grand Fir",
                        "Pacific Madrona",
                        "Pondarosa Pine",
                        "Red Cedar",
                        "White Fir",
                        "White Oak",
                        "Woody Biomass"]
                }
            },
            { title: "Date", field: "date", editor: "input" },
            {
                title: "Product", field: "product", editor: "select",
                editorParams: {
                    values: ['None',
                        'Firewood',
                        'FishLogs',
                        'HogFuel',
                        'Lumber',
                        'Paper',
                        'Poles',
                        'Pulp',
                        'ShakeFencing',
                        'Slash',
                        'Rock',
                        'Scraps',
                        'Utility',
                        'Veneer']
                }
            },
            { title: "Book No", field: "Book_No", editor: "input" },
            { title: "Ticket No", field: "Ticket_No", editor: "input" },
            { title: "Sawmill", field: "Sawmill", editor: "input" },
            { title: "Utility", field: "Utility", editor: "input" },
        ],
        layout: "fitColumns", // fit columns to width of table
        responsiveLayout: "hide", // hide columns that dont fit on the table
        tooltips: true // show tool tips on cells
    });

    var urlParams = new URLSearchParams(window.location.search);
    var pgid = urlParams.get('gid');
    require(["esri/identity/IdentityManager", "esri/request", "dojo/domReady!"], function (IdentityManager, esriRequest) {
        // Fetch the data when the document is ready
        esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/9/query", {
            responseType: "json",
            query: {
                where: "parentglobalid = '" + pgid + "'",
                outFields: "*",
                f: "json"
            }
        }).then(function (response) {
            // Extract data
            var tableData = response.data.features.map(function (feature) {
                return feature.attributes;
            });

            // Define table
            table = new Tabulator("#certtable", {
                data: tableData, //assign data to table
                columns: [
                    { title: "Certificate No", field: "CertificateNo", editor: "input" },
                    { title: "Scale Date", field: "StartingScaleDate", editor: "input", formatter: "datetime" },
                    { title: "Book No", field: "LoadBookNo", editor: "input" },
                    { title: "Ticket No", field: "LoadTicketNo", editor: "input" },
                    { title: "Loads", field: "Loads", editor: "input" },
                    { title: "Acres Cut", field: "AcresCut", editor: "input" },
                    { title: "Sawlog", field: "Sawlog", editor: "input" },
                    { title: "Utility", field: "Utility", editor: "input" },
                    { title: "Clean Log Utility", field: "CleanLogUtility", editor: "input" },
                    { title: "Slash Rock", field: "Slash_Rock", editor: "input" },
                    { title: "Payment", field: "Payment", editor: "input" },
                    { title: "Other Charges Due", field: "OtherChargesDue", editor: "input" },
                    { title: "Other Fees Paid", field: "OtherFeesPaid", editor: "input" },
                    { title: "Species Type", field: "SpeciesType", editor: "input" },
                    { title: "Destination", field: "CertificateDestinationNo", editor: "input" },
                    { title: "Product Processed", field: "CertificateProductProcessed", editor: "input" },
                    { title: "Comments", field: "CertComments", editor: "input" },
                    { title: "FirewoodAreaCut", field: "FirewoodAreaCut", editor: "input" },
                    { title: "Show Comments on Statement?", field: "certcommentsonstateme", editor: "input", editor: true, formatter: "tickCross", formatterParams: { allowEmpty: false } },
                    { title: "Show Comments on Report?", field: "certcommentsonreport", editor: "input", editor: true, formatter: "tickCross", formatterParams: { allowEmpty: false } },
                    { title: "CV Number", field: "CVNumber", editor: "input" },
                    { title: "CV Date", field: "CVDate", editor: "input", formatter: "datetime" },
                    { title: "F_Complete", field: "F_Complete", editor: "input" },
                    { title: "FundAcct", field: "FundAcct", editor: "input" },
                    { title: "OBJECTID", field: "OBJECTID", editor: "input", visible: false }

                ]
            });
            table.on("cellEdited", function (cell) {
                //cell - cell component
                var field = cell.getField(); // get field name
                var value = cell.getValue(); // get current cell value
                var row = cell.getRow().getData(); // get the data for the row
                var objectId = row.OBJECTID; //assuming OBJECTID is a field in your data
                handleEdit(field, value, objectId);
            });
        })
    });

    function handleEdit(field, value, objectId) {
        require(["esri/identity/IdentityManager", "esri/request", "dojo/domReady!"],
            function (IdentityManager, esriRequest) {
                console.log(field, value, objectId)
                // Fetch the data when the document is ready

                const features = [{
                    "attributes": {
                        "OBJECTID": objectId,
                        [field]: value
                    }
                }];

                const formData = new URLSearchParams();
                formData.append('f', 'json');
                formData.append('features', JSON.stringify(features));
                console.log(features);
                esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/7/updateFeatures ", {
                    method: "post ",
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData.toString()
                }).then(function (response) {
                    console.log(response.data);
                }).catch(function (error) {
                    console.error(error);
                });

            });
    }

    let selectedAddress = ''; // Move this line here
    let featureMap = new Map();

    document.getElementById('dataForm').addEventListener('submit', function (event) {
        event.preventDefault();
        updateValues(event);

    });

    function updateValues(event) {
        event.preventDefault(); // Prevent the form from submitting

        // Get the current values of LoadBookNo and LoadTicketNo
        const loadBookNoInput = document.getElementById('loadBookNo');
        const loadTicketNoInput = document.getElementById('loadTicketNo');

        const currentLoadBookNo = parseInt(loadBookNoInput.value);
        const currentLoadTicketNo = parseInt(loadTicketNoInput.value);

        loadBookNoInput.value = currentLoadBookNo; // This line is not necessary, but included for clarity

        if (!isNaN(currentLoadTicketNo)) {
            loadTicketNoInput.value = currentLoadTicketNo + 1;
        } else {
            loadTicketNoInput.value = 1;
        }

        const certTicketNoInput = document.getElementById('certificateNo');

        const currentcertTicketNo = parseInt(certTicketNoInput.value);


        if (!isNaN(currentLoadTicketNo)) {
            certTicketNoInput.value = currentcertTicketNo + 1;
        } else {
            certTicketNoInput.value = 1;
        }

    }
    require(["esri/identity/IdentityManager", "esri/request", "dojo/domReady!"],
        function (IdentityManager, esriRequest) {
            // Fetch the data when the document is ready
            function updateValues(event) {
                event.preventDefault();
                const dateInput = document.getElementById('date').value;
                const date = new Date(dateInput);
                const StartingScaleDate = Math.floor(date.getTime() / 1000);
                const LoadBookNo = document.getElementById('loadBookNo').value;
                const LoadTicketNo = parseInt(document.getElementById('loadTicketNo').value);
                const CertificateNo = document.getElementById('certificateNo').value;
                const Destination = document.getElementById('destination').value;
                const CertificateProductProcessed = document.getElementById('certificateProductProcessed').value;
                const Species = document.getElementById('species').value;
                const Loads = document.getElementById('loads').value;
                const AcresCut = document.getElementById('acresCut').value;
                const Sawlog = document.getElementById('sawlog').value;
                const Utility = document.getElementById('utility').value;
                const CleanLogUtility = document.getElementById('cleanLogUtility').value;
                const SlashRock = document.getElementById('slashRock').value;
                const Payment = document.getElementById('payment').value;
                const OtherChargesDue = document.getElementById('otherChargesDue').value;

                const features = [{
                    "attributes": {
                        "LoadBookNo": LoadBookNo,
                        "LoadTicketNo": LoadTicketNo,
                        "StartingScaleDate": StartingScaleDate,
                        "CertificateNo ": CertificateNo,
                        "Destination": Destination,
                        "CertificateProductProcessed": CertificateProductProcessed,
                        "Species": Species,
                        "Loads": Loads,
                        "AcresCut": AcresCut,
                        "Sawlog": Sawlog,
                        "Utility": Utility,
                        "CleanLogUtility": CleanLogUtility,
                        "SlashRock": SlashRock,
                        "Payment": Payment,
                        "OtherChargesDue": OtherChargesDue,
                        "parentglobalid": pgid
                    }
                }];

                const formData = new URLSearchParams();
                formData.append('f', 'json');
                formData.append('features', JSON.stringify(features));
                console.log(features);

                esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Forestry/FeatureServer/9/addFeatures ", {
                    method: "post ",
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData.toString()
                }).then(function (response) {
                    const success = response.data.updateResults[0];
                    const submitButton = document.getElementById('submitButton');  // Selecting the button

                    if (success) {
                        submitButton.value = 'SUCCESS!';
                    } else {
                        submitButton.value = 'FAILED!';
                    }

                    setTimeout(() => {
                        submitButton.value = 'Submit Edits'; // clear the message after 3 seconds
                    }, 3000);
                });
            }


        });
    document.getElementById("download-csv").addEventListener("click", function () {
        table.download("csv", "Signers.csv");
    });


    //////////////////////////////////////////////////////////////////////////////

    document.addEventListener('DOMContentLoaded', () => {
        const pdfjsLib = window['pdfjs-dist/build/pdf'];

        const companyParsers = {
            'pacific-rim': parsePacificRimPDF,
            'northwest': parseNorthwestPDF,
            'columbia': parseColumbiaPDF
            // ... add more company parsers as needed ...
        };

        // Function to handle dropdown item clicks
        const dropdownItems = document.querySelectorAll('.dropdown-item');
        dropdownItems.forEach(item => {
            item.addEventListener('click', function () {
                const companyName = this.dataset.company;
                if (companyName && companyParsers[companyName]) {
                    currentParser = companyParsers[companyName];
                    document.getElementById('pdf-input').click();
                } else {
                    console.error('Parser for the selected company is not defined.');
                }
            });
        });

        let currentParser = null;

        document.getElementById('pdf-input').addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (file && file.type === 'application/pdf') {
                // Read the PDF file as an ArrayBuffer
                const arrayBuffer = await file.arrayBuffer();

                // Loading the PDF document from the ArrayBuffer
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

                // // Fetching the first page
                const page = await pdf.getPage(1);


                const textContent = await page.getTextContent();
                const textItems = textContent.items.map(item => item.str).join(' ');



                if (currentParser) {
                    currentParser(textItems);
                } else {
                    console.error('No parser function is selected.');
                }
            }
            // ... [rest of your event listener remains the same] ...
        });
    });

    document.getElementById('pdfSubmitBtn').addEventListener('click', function () {
        var currentTableData = table2.getData();
        yourFunction(currentTableData);

        // Hide the modal
        var modal = bootstrap.Modal.getInstance(document.getElementById('dataModal'));
        modal.hide();
    });

    function parsePacificRimPDF(text) {
        const results = []
        console.log('Pacific Rim')
        // Extract the date
        const dateRegex = /\d{1,2}\/\d{1,2}\/\d{4}/g;
        const dates = text.match(dateRegex);

        // Extract the certificate numbers
        const certificateRegex = /Bureau Number (\d+)/g;
        const certificates = [];
        let match;
        while ((match = certificateRegex.exec(text)) !== null) {
            certificates.push(match[1]);
        }

        // Extract the species
        const speciesRegex = /Logs Species Grade\s+([\w\s]+)-/g;

        const species = [];
        while ((match = speciesRegex.exec(text)) !== null) {
            species.push(match[1].trim());
        }
        const unwantedString = "Gross   Net   Gross Utility Net Utility Gross Cubic Net Merch Cubic Net Chips Cubic";
        const cleanedSpecies = species[0].replace(unwantedString, '').trim();


        results.push({
            date: dates[0],
            certificateNumbers: certificates[0],
            species: cleanedSpecies
        });

        // Step 1: Identify the Start and End of the Table
        const tableStart = text.indexOf("Yard Receipt");
        const tableEnd = text.search(/\d+\s+Loads/);

        // Check if the table markers were found
        if (tableStart === -1 || tableEnd === -1) {
            return "Table markers not found";
        }

        // Step 2: Extract the Table Text
        const tableText = text.substring(tableStart, tableEnd);

        // Step 3: Parse the Rows and Columns
        const rows = tableText.split('\n');
        var tableData = rows.map(row => {
            // Replace multiple spaces with a single space and then split by space
            return row.replace(/\s+/g, ' ').trim().split(' ');
        });
        //remove first 2 items from array
        const CleanTableData = tableData[0];
        CleanTableData.shift();
        CleanTableData.shift();
        const CleanTableDataLength = CleanTableData.length;
        var numToSplit = 5

        if (CleanTableDataLength >= 10 && CleanTableDataLength <= 12) {
            numToSplit = 1;
        } else if (CleanTableDataLength >= 21 && CleanTableDataLength <= 24) {
            numToSplit = 2;
        } else if (CleanTableDataLength >= 30 && CleanTableDataLength <= 35) {
            numToSplit = 3;
        } else if (CleanTableDataLength >= 40 && CleanTableDataLength <= 45) {
            numToSplit = 4;
        }

        const chunkSize = Math.ceil(CleanTableData.length / numToSplit);
        const splitResult = [];

        for (let i = 0; i < numToSplit; i++) {
            const start = i * chunkSize;
            const end = start + chunkSize;
            splitResult.push(CleanTableData.slice(start, end));
        }

        console.log(splitResult)
        var newTableData = splitResult.map((item) => {
            return {
                certificate_no: results[0].certificateNumbers,
                species: results[0].species.replace('Doug Fir', 'Douglas Fir'),
                date: results[0].date,
                product: 'Lumber',
                Book_No: item[1].substring(0, 4),
                Ticket_No: item[1].slice(-2),
                Sawmill: item[3],
                Utility: item[4],
            };
        });

        console.log(newTableData)
        table2.setData(newTableData);

        // Show the modal
        var modal = new bootstrap.Modal(document.getElementById('dataModal'), {});
        modal.show();
    }

    function parseNorthwestPDF(text) {
        text = text.replace(/\s*-\s*/g, '-');
        console.log('Northwest')
        const tableDataStart = text.indexOf('Net   Net   Weight  ') + 'Net   Net   Weight  '.length;
        const tableDataEnd = text.indexOf(' Total   All   Loads');
        const tableData = text.slice(tableDataStart, tableDataEnd).trim();
        const match = text.match(/Certificate:\s*(\S+)/);
        // 2. Split the data into rows
        const rows = tableData.split('\n').map(row => row.trim());

        // 3. Split the rows into columns and clean up the data
        const parsedTableData = rows.map(row => {
            const columns = row.split(/\s+/).map(column => {
                // Convert to number if possible
                if (!isNaN(column.replace(',', ''))) {
                    return parseFloat(column.replace(',', ''));
                }
                return column;
            });
            return columns;
        });
        const CleanTableData = parsedTableData[0];


        let numToSplit = 0;

        for (const item of CleanTableData) {
            if (typeof item === 'string') {
                numToSplit++;
            }
        }
        const CleanTableDataLength = CleanTableData.length;

        const chunkSize = Math.ceil(CleanTableDataLength / numToSplit);

        console.log(chunkSize, CleanTableDataLength.length, numToSplit)
        const splitResult = [];

        for (let i = 0; i < numToSplit; i++) {
            const start = i * chunkSize;
            const end = start + chunkSize;
            splitResult.push(CleanTableData.slice(start, end));
        }
        console.log(splitResult)
        var newTableData = splitResult.map((item) => {
            return {
                certificate_no: match[1],
                species: 'Douglas Fir',
                date: item[3],
                product: 'Lumber',
                Book_No: item[2].toString().substring(0, 4),
                Ticket_No: item[2].toString().slice(-2),
                Sawmill: item[6],
                Utility: item[7],
            };
        });
        console.log(newTableData)
        // Set the data for the table
        table2.setData(newTableData);

        // Show the modal
        var modal = new bootstrap.Modal(document.getElementById('dataModal'), {});
        modal.show();
    }

    function parseColumbiaPDF(text) {
        console.log(text)
        var CleanTableData
        var numToSplit = 1
        const regexl = /TOTAL[^\d]*([\d,]+)\s*LOADS/i;
        const matchl = text.match(regexl);
        if (matchl && matchl[1]) {
            numToSplit = parseInt(matchl[1].replace(/,/g, ''), 10);
        }


        const regex = /ISSUED   BUREAU   PAGE [^\d]*(\d{2}\/\d{2}\/\d{4})/;
        const match = text.match(regex);

        const regex2 = /LOGS[^\d]+(\d{5}[^\-]+-{10})/s;
        const match2 = text.match(regex2);
        if (match2 && match2[1]) {
            // Cleaning the data
            CleanTableData = match2[1].trim().split(/\s+/);
        }
        CleanTableData.shift();
        CleanTableData.shift();
        CleanTableData.shift();
        CleanTableData.pop();

        const CleanTableDataLength = CleanTableData.length;

        const chunkSize = Math.ceil(CleanTableDataLength / numToSplit);

        console.log(chunkSize, CleanTableDataLength.length, numToSplit)
        const splitResult = [];

        for (let i = 0; i < numToSplit; i++) {
            const start = i * chunkSize;
            const end = start + chunkSize;
            splitResult.push(CleanTableData.slice(start, end));
        }
        console.log(splitResult)

        var newTableData = splitResult.map((item) => {
            return {
                certificate_no: item[0],
                species: 'Douglas Fir',
                date: match[1],
                product: 'Lumber',
                Book_No: item[1].substring(0, 4),
                Ticket_No: item[1].slice(-2),
                Sawmill: item[5]
            };
        });
        console.log(newTableData)
        // Set the data for the table
        table2.setData(newTableData);

        // Show the modal
        var modal = new bootstrap.Modal(document.getElementById('dataModal'), {});
        modal.show();

    }

</script>

</html>